<!DOCTYPE html>
<html>
<head>
    <title>API测试页面</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>教务系统API测试</h1>
    
    <div>
        <h2>测试登录</h2>
        <button onclick="testLogin()">测试管理员登录</button>
        <button onclick="testWrongPassword()">测试错误密码</button>
        <div id="loginResult"></div>
    </div>
    
    <div>
        <h2>测试管理员API</h2>
        <button onclick="testGetTeachers()">获取教师列表</button>
        <button onclick="testGetStudents()">获取学生列表</button>
        <button onclick="testGetCourses()">获取课程列表</button>
        <div id="apiResult"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let token = '';

        async function testLogin() {
            try {
                const response = await axios.post(`${API_BASE}/auth/login`, {
                    username: 'admin',
                    password: 'admin123',
                    user_type: 'admin'
                });
                
                token = response.data.access_token;
                document.getElementById('loginResult').innerHTML = 
                    `<p style="color: green;">登录成功！Token: ${token.substring(0, 20)}...</p>`;
                
                // 设置后续请求的认证头
                axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 
                    `<p style="color: red;">登录失败: ${error.response?.data?.message || error.message}</p>`;
            }
        }

        async function testWrongPassword() {
            try {
                const response = await axios.post(`${API_BASE}/auth/login`, {
                    username: 'admin',
                    password: 'wrongpassword',
                    user_type: 'admin'
                });
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 
                    `<p style="color: red;">密码错误测试 - ${error.response?.data?.message || error.message}</p>`;
            }
        }

        async function testGetTeachers() {
            if (!token) {
                alert('请先登录');
                return;
            }
            
            try {
                const response = await axios.get(`${API_BASE}/admin/teachers`);
                document.getElementById('apiResult').innerHTML = 
                    `<p style="color: green;">教师数据: <pre>${JSON.stringify(response.data, null, 2)}</pre></p>`;
            } catch (error) {
                document.getElementById('apiResult').innerHTML = 
                    `<p style="color: red;">获取教师列表失败: ${error.response?.data?.message || error.message}</p>`;
            }
        }

        async function testGetStudents() {
            if (!token) {
                alert('请先登录');
                return;
            }
            
            try {
                const response = await axios.get(`${API_BASE}/admin/students`);
                document.getElementById('apiResult').innerHTML = 
                    `<p style="color: green;">学生数据: <pre>${JSON.stringify(response.data, null, 2)}</pre></p>`;
            } catch (error) {
                document.getElementById('apiResult').innerHTML = 
                    `<p style="color: red;">获取学生列表失败: ${error.response?.data?.message || error.message}</p>`;
            }
        }

        async function testGetCourses() {
            if (!token) {
                alert('请先登录');
                return;
            }
            
            try {
                const response = await axios.get(`${API_BASE}/admin/courses`);
                document.getElementById('apiResult').innerHTML = 
                    `<p style="color: green;">课程数据: <pre>${JSON.stringify(response.data, null, 2)}</pre></p>`;
            } catch (error) {
                document.getElementById('apiResult').innerHTML = 
                    `<p style="color: red;">获取课程列表失败: ${error.response?.data?.message || error.message}</p>`;
            }
        }
    </script>
</body>
</html>
